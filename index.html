<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>

    <link rel="stylesheet" type="text/css" href="main.css">

    <script src="./node_modules/web3/dist/web3.min.js"></script>

</head>
<body>
		<div class="container">

				<h1>King of the hill</h1>
				<span id="countIns"></span>
		
				<h2 id="instructor"></h2>
				<span id="insTrans"></span>
				<hr>
		
				<img id="loader" src="https://media2.giphy.com/media/131tNuGktpXGhy/giphy.gif?cid=790b76115cfef426664371312e9b35be&rid=giphy.gif">
		
				<label for="fName" class="col-lg-2 control-label">First Name</label>
				<input id="fName" type="text">
		
				<label for="start" class="col-lg-2 control-label">Start</label>
				<input id="start" type="text">
		
				<button id="button">Update Instructor</button>
		
		</div>

    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>

    <script>
        // var Web3 = require("web3")
        if (typeof web3 !== 'undefined') {
            web3 = new Web3(web3.currentProvider);
        } else {
            // set the provider you want from Web3.providers
            web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:8545"));
        }

        web3.eth.defaultAccount = web3.eth.accounts[0];

        var KingContract = web3.eth.contract([
	{
		"constant": false,
		"inputs": [
			{
				"name": "_address",
				"type": "address"
			},
			{
				"name": "_start",
				"type": "uint256"
			},
			{
				"name": "_fName",
				"type": "bytes16"
			}
		],
		"name": "setKing",
		"outputs": [],
		"payable": false,
		"stateMutability": "nonpayable",
		"type": "function"
	},
	{
		"anonymous": false,
		"inputs": [
			{
				"indexed": false,
				"name": "fName",
				"type": "bytes16"
			},
			{
				"indexed": false,
				"name": "start",
				"type": "uint256"
			}
		],
		"name": "kingInfo",
		"type": "event"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "countKings",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "_address",
				"type": "address"
			}
		],
		"name": "getKing",
		"outputs": [
			{
				"name": "",
				"type": "uint256"
			},
			{
				"name": "",
				"type": "bytes16"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [],
		"name": "getKings",
		"outputs": [
			{
				"name": "",
				"type": "address[]"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	},
	{
		"constant": true,
		"inputs": [
			{
				"name": "",
				"type": "uint256"
			}
		],
		"name": "kingAccts",
		"outputs": [
			{
				"name": "",
				"type": "address"
			}
		],
		"payable": false,
		"stateMutability": "view",
		"type": "function"
	}
]);

var King = KingContract.at('0x278bd77e69c68b8110a67b5f3c9ce1c1249d2604');

var kingEvent = King.kingInfo({},'latest');

kingEvent.watch(function (err, result) {
    if (!err) {
        if (result.blockHash != $("#instrans").html()) 
            $("#loader").hide();
            
        $("#insTrans").html('Block hash: ' +result.blockHash);
        $("#instructor").html(web3.toAscii(result.args.fName) + ' :' + result.args.start + ' ...)');
    } else {
        $("#loader").hide();
    }
});

King.countKings((err, res) => {
    if (res)
        $("#countIns").html(res.c + ' Instructors'); 
});

		
$("#button").click(function() {
    $("#loader").show();
    King.setKing(web3.eth.defaultAccount, $("#start").val(), $("#fName").val(), (err, res) => {
        if (err) 
            $("#loader").hide();
})
});

</script>

</body>
</html>